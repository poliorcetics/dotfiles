# Settings: <https://docs.jj-vcs.dev/latest/config/>
"$schema" = "https://docs.jj-vcs.dev/latest/config-schema.json"

# <https://docs.jj-vcs.dev/latest/config/#aliases>
[aliases]
b = ["bookmark"]
c = ["commit"]
ci = ["commit", "--interactive"]
d = ["diff"]
ds = ["describe"]
dt = ["diff", "--tool", "difft"]
g = ["git"]
gf = ["git", "fetch"]
gp = ["git", "push"]
gpa = ["git", "push", "--all"]
l = ["log"]
lb = ["log", "-r", "current()"]
lm = ["log", "-r", "::@"]
lo = ["log", "-r", "visible_open()"]
r = ["rebase"]
rs = ["rebase", "--source", "visible_open_roots()", "--destination"]
s = ["status"]
sq = ["squash"]

# <https://docs.jj-vcs.dev/latest/config/#git-settings>
[git]
private-commits = "description(glob:'LOCAL:*')"
subprocess = true
# <https://docs.jj-vcs.dev/latest/config/#automatically-signing-commits>
sign-on-push = true

[merge-tools.difft]
diff-args = [
  "--display",
  "side-by-side-show-both",
  "--color=always",
  "$left",
  "$right",
]

[revset-aliases]
"current()" = "(::@ ~ ::trunk())"
"open()" = "((::tracked_remote_bookmarks() | mine()) ~ ::trunk())::"
"visible_open()" = "(open() & ::visible_heads())::"
# Useful to rebase all branches with `jj r -s "all:visible_open_roots()" -d main/master/develop/..`
"visible_open_roots()" = "roots(visible_open())"

# <https://docs.jj-vcs.dev/latest/config/#commit-signing>
# <https://docs.jj-vcs.dev/latest/config/#ssh-signing>
[signing]
backend = "ssh"
behaviour = "own"
key = "~/.ssh/id_signing.pub"

[templates]
# Template for `jj describe` (and so, `jj commit`)
# NOTE: could become unwieldy with super large diffs or when editing multiple commits at once
draft_commit_description = '''
concat(
  builtin_draft_commit_description,
  "JJ: ====================================================================\n",
  "JJ: ignore-rest\n",
  diff.git(),
)
'''
# Template for auto-generated bookmark names
git_push_bookmark = '"ab/push-" ++ change_id.short()'

[template-aliases]
# Use a minimum length of 8, ensuring my Kitty config can detect such IDs all the time
"format_short_id(id)" = "id.shortest(8)"

# <https://docs.jj-vcs.dev/latest/config/#ui-settings>
[ui]
# <https://docs.jj-vcs.dev/latest/conflicts/#alternative-conflict-marker-styles>
conflict-marker-style = "snapshot"
default-command = "status"
# <https://docs.jj-vcs.dev/latest/config/#diff-format>
diff-formatter = ":git"
pager = "delta"
